(window.webpackJsonp=window.webpackJsonp||[]).push([[63],{488:function(s,a,t){"use strict";t.r(a);var n=t(2),e=Object(n.a)({},(function(){var s=this,a=s._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("p",[s._v("我们先从一段代码说起")]),s._v(" "),a("p",[s._v("这是SpringBoot的启动类")]),s._v(" "),a("div",{staticClass:"language-java line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@SpringBootApplication")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("SpringBootApplication")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("static")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("main")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" args"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ConfigurableApplicationContext")]),s._v(" context "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("SpringApplication")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("run")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("A03")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" args"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        context"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("close")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])]),a("p",[s._v("同一包下,有这么一个类")]),s._v(" "),a("div",{staticClass:"language-java line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Component")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("LifeCycleBean")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("static")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("final")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Logger")]),s._v(" log "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("LoggerFactory")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("getLogger")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("LifeCycleBean")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("LifeCycleBean")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        log"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("debug")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"实例化"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Autowired")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("autowire")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Value")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"${JAVA_HOME}"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" home"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        log"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("debug")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"属性填充: {}"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" home"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@PostConstruct")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("init")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        log"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("debug")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"初始化"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@PreDestroy")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("destroy")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        log"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("debug")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"销毁"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br")])]),a("h3",{attrs:{id:"创建前的准备"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#创建前的准备"}},[s._v("#")]),s._v(" 创建前的准备")]),s._v(" "),a("p",[s._v("在bean的生命周期开始前")]),s._v(" "),a("p",[s._v("Spring容器启动后")]),s._v(" "),a("p",[s._v("会先执行loadBeanDefinitions()方法得到bean定义的集合")]),s._v(" "),a("h2",{attrs:{id:"bean的生命周期"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#bean的生命周期"}},[s._v("#")]),s._v(" Bean的生命周期")]),s._v(" "),a("p",[s._v("执行启动类,会输出对应结果")]),s._v(" "),a("p",[s._v("所以Bean的生命周期分别是")]),s._v(" "),a("ol",[a("li",[s._v("实例化")]),s._v(" "),a("li",[s._v("属性填充")]),s._v(" "),a("li",[s._v("初始化")]),s._v(" "),a("li",[s._v("销毁")])]),s._v(" "),a("h3",{attrs:{id:"_1-实例化"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-实例化"}},[s._v("#")]),s._v(" 1.实例化")]),s._v(" "),a("p",[s._v("Bean实例化基本流程 :")]),s._v(" "),a("ol",[a("li",[s._v("BeanDefinnitionReader加载xml配置文件,解析获取配置中每个bean的信息,封装成一个个的BeanDefinition对象")]),s._v(" "),a("li",[s._v("将BeanDefinition存储在一个名为beanDefinnitionMap的Map<String ,BeanDefinition>中")]),s._v(" "),a("li",[s._v("ApplicationContext底层遍历beanDefinitionMap,创建Bean实例对象")]),s._v(" "),a("li",[s._v("创建好的Bean实例对象,被存储到一个名为singletonObject(单例池)的Map<String ,Object>中")]),s._v(" "),a("li",[s._v("当执行applicationContext.getBean(beanName),congsingletonObject去匹配Bean实例返回")])]),s._v(" "),a("p",[a("img",{attrs:{src:"https://18334034784.oss-cn-chengdu.aliyuncs.com/lin-oss/bean%E5%AE%9E%E4%BE%8B%E5%8C%96.png",alt:"image-20231116153214011"}})]),s._v(" "),a("h3",{attrs:{id:"_2-属性填充-依赖注入"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-属性填充-依赖注入"}},[s._v("#")]),s._v(" 2.属性填充/依赖注入")]),s._v(" "),a("p",[s._v("通过populateBean()方法对Bean内部所需属性进行赋值填充")]),s._v(" "),a("p",[s._v("注入的属性值会被"),a("strong",[s._v("BeanDefinition")]),s._v("封装")]),s._v(" "),a("p",[s._v("有如下三种情况 :")]),s._v(" "),a("ul",[a("li",[s._v("普通属性 : String,int基本数据类型时,直接通过set方法的反射设置进去")]),s._v(" "),a("li",[s._v("单项对象引用 : 如Service对象引用了Dao对象,从容器中getBean获取后通过set方法反射设置进去.如果容器中没有则先创建被注入对象Bean实例,再进行注入当前对象")]),s._v(" "),a("li",[s._v("双向对象引用属性: 设计循环依赖问题,待会详讲 ......")])]),s._v(" "),a("h3",{attrs:{id:"_3-初始化"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-初始化"}},[s._v("#")]),s._v(" 3.初始化")]),s._v(" "),a("p",[a("u",[s._v("初始化的三种方法及执行顺序")]),s._v(":")]),s._v(" "),a("ol",[a("li",[s._v("@PostConstruct方法注解")]),s._v(" "),a("li",[s._v("InitializingBean接口")]),s._v(" "),a("li",[s._v('@Bean(initiMethod="")注解')])]),s._v(" "),a("p",[a("u",[s._v("如何进行初始化呢?")])]),s._v(" "),a("p",[s._v("通过**InitializeBean()**方法初始化Bean")]),s._v(" "),a("ol",[a("li",[a("p",[s._v("通过invokeAwareMethods()方法为实现了各种Aware接口(信息感知接口)的Bean设置信息,如beanName,beanFactory等")])]),s._v(" "),a("li",[a("p",[s._v("通过invokeInitMethods()方法执行Bean的初始化方法")])]),s._v(" "),a("li",[a("p",[s._v("执行afterPropertiesSet()方法,即属性注入后执行的方法")])]),s._v(" "),a("li",[a("p",[s._v("执行自定义initMethod()方法")])]),s._v(" "),a("li",[a("p",[s._v("在第四步执行之前和之后,需要对Bean后处理器,BeanPostProcessors进行处理")])]),s._v(" "),a("li",[a("p",[s._v("注册销毁,通过**registerDisposableBean()**方法将实现类销毁接口DisposableBean的Bean进行注册")])])]),s._v(" "),a("p",[s._v("常见后处理器")]),s._v(" "),a("ul",[a("li",[s._v("AnnotationAwareAspectJAutoProxyCreator : 负责AOP处理")]),s._v(" "),a("li",[s._v("负责构造后**@PostConstruct"),a("strong",[s._v("和销毁前")]),s._v("@PreDestroy**处理的lnitDestroyAnnotationBeanPostProcessor等")]),s._v(" "),a("li",[s._v("实现BeanPostPressors接口的自定义后处理器")])]),s._v(" "),a("h3",{attrs:{id:"_4-销毁"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-销毁"}},[s._v("#")]),s._v(" 4.销毁")]),s._v(" "),a("p",[a("u",[s._v("销毁Bean的三种方法及执行顺序")]),s._v(":")]),s._v(" "),a("ol",[a("li",[s._v("@PreDestroy方法注解")]),s._v(" "),a("li",[s._v("实现DispossableBean")]),s._v(" "),a("li",[s._v('@Bean(destroyMethod="")')])]),s._v(" "),a("p",[s._v("执行postProcessBeforreDestruction()方法,销毁前处理器,也就是**@PreDestory**修饰的方法")]),s._v(" "),a("p",[s._v("再执行destory()销毁")]),s._v(" "),a("p",[s._v("最后通过invokeCustomDestoryMethod()方法去执行自定义destroyMethod方法")]),s._v(" "),a("h2",{attrs:{id:"问题详解"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#问题详解"}},[s._v("#")]),s._v(" 问题详解")]),s._v(" "),a("h3",{attrs:{id:"循环依赖"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#循环依赖"}},[s._v("#")]),s._v(" 循环依赖")]),s._v(" "),a("p",[s._v("我们刚才说过,当注入属性时,两个对象相互依赖")]),s._v(" "),a("p",[s._v("A内部需要注入B,B内部需要注入A")]),s._v(" "),a("p",[s._v("有点像死锁 ......")]),s._v(" "),a("p",[s._v("流程是这样的")]),s._v(" "),a("p",[s._v("实例化Bean1 ---\x3e 属性填充需要Bean2 ---\x3e 判断容器中是否含有Bean2")]),s._v(" "),a("p",[s._v("---\x3e 有,则初始化")]),s._v(" "),a("p",[s._v("---\x3e 没有,则实例化Bean2")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://18334034784.oss-cn-chengdu.aliyuncs.com/lin-oss/%E5%BE%AA%E7%8E%AF%E4%BE%9D%E8%B5%96.png",alt:"image-20231116162043189"}})]),s._v(" "),a("p",[s._v("如果从单例池中寻找肯定是找不到的")]),s._v(" "),a("p",[s._v("所以先实例化Bean2,此时Bean2只经过了实例化")]),s._v(" "),a("p",[s._v("没有走完生命周期,故还是个半成品")]),s._v(" "),a("p",[s._v("Bean2也是如此,于是构成了死循环")]),s._v(" "),a("p",[a("big",[a("strong",[s._v("解决方案")])])],1),s._v(" "),a("p",[s._v("关键点在于再容器中判断是否够含有Bean2的这一步")]),s._v(" "),a("p",[s._v("可以不从单例池中寻找")]),s._v(" "),a("p",[s._v("转而提供半成品Bean2的Map中寻找,是Bean1维护者Bean的引用即可")]),s._v(" "),a("p",[s._v("Spring实现引用的方案为 --- 三级缓存")]),s._v(" "),a("h3",{attrs:{id:"三级缓存"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#三级缓存"}},[s._v("#")]),s._v(" 三级缓存")]),s._v(" "),a("p",[s._v("Spring提供了"),a("strong",[s._v("三级缓存")]),s._v("存储 "),a("font",{attrs:{color:"red"}},[s._v("完整Bean实例")]),s._v("和"),a("font",{attrs:{color:"red"}},[s._v("半成品Bean实例")]),s._v(",用于解决循环依赖问题")],1),s._v(" "),a("p",[s._v("在DefaultListableFactory的上四级父类DefaultSingletonBeanRegistry中提供如下三个Map:")]),s._v(" "),a("ul",[a("li",[s._v("一级缓存 : 最终存储单例Bean承平的容器,即实例化和初始化都完成的Bean")])]),s._v(" "),a("div",{staticClass:"language-java line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Map")]),a("span",{pre:!0,attrs:{class:"token generics"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("0bject"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" singletonObjects "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ConcurrentHashMap")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("256")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("ul",[a("li",[s._v("二级缓存 : 早期Bean单例池,缓存半成品对象,且当前对象已经被其他对象引用了")])]),s._v(" "),a("div",{staticClass:"language-java line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Map")]),a("span",{pre:!0,attrs:{class:"token generics"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("0bject"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" earlySingletonobjects "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ConcurrentHashMap")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("ul",[a("li",[s._v("三级缓存 : 单例Bean的工厂池,缓存半成品对象,对象未被引用,使用在通过工程创建Bean")])]),s._v(" "),a("div",{staticClass:"language-java line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Map")]),a("span",{pre:!0,attrs:{class:"token generics"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("string"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("0bjectFactory"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("?")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" singletonFactories "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("HashMap")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("所以循环依赖的解决流程如下 :")]),s._v(" "),a("ol",[a("li",[s._v("实例化Bean1,包一层ObjectFactory,放入三级缓存中")]),s._v(" "),a("li",[s._v("判断属性注入Bean2时,在三级缓存中找一遍,没找到")]),s._v(" "),a("li",[s._v("实例化Bean2,放入三级缓存")]),s._v(" "),a("li",[s._v("判断属性注入,找到了Bean1,将三级缓存中的Bean1放入二级缓存中")]),s._v(" "),a("li",[s._v("初始化Bean2完成,将Bean2由三级缓存放入一级缓存")]),s._v(" "),a("li",[s._v("继续初始化Bean1,完成后放入一级缓存")])]),s._v(" "),a("p",[s._v("通过**addSingleton()**方法将完整的对象放入单例池")]),s._v(" "),a("p",[s._v("即可使用完整的Bean")])])}),[],!1,null,null,null);a.default=e.exports}}]);