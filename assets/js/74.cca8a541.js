(window.webpackJsonp=window.webpackJsonp||[]).push([[74],{496:function(s,a,t){"use strict";t.r(a);var n=t(2),r=Object(n.a)({},(function(){var s=this,a=s._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h2",{attrs:{id:"一-字符串常量池"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#一-字符串常量池"}},[s._v("#")]),s._v(" 一.字符串常量池")]),s._v(" "),a("p",[s._v("字符串池在JDK1.7之后存在于堆中的一块区域")]),s._v(" "),a("p",[s._v("常量池中的信息都会被加载到运行时常量池中,这是 a b ab都是常量池中的符号,还没有变为Java字符串对象")]),s._v(" "),a("h2",{attrs:{id:"二-示例详解"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#二-示例详解"}},[s._v("#")]),s._v(" 二.示例详解")]),s._v(" "),a("div",{staticClass:"language-java line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("static")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("main")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" args"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" s1 "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"a"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" s2 "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"b"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" s3 "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ab"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("p",[s._v("创建前一个字符串对象前,会先在"),a("strong",[s._v("StringTable")]),s._v("中寻找有没有这个对象")]),s._v(" "),a("p",[s._v("以上程序运行完")]),s._v(" "),a("p",[s._v('StringTable["a", "b", "ab"]')]),s._v(" "),a("p",[s._v("这是一个hashtable结构,不能扩容")]),s._v(" "),a("h3",{attrs:{id:"_1-string-s4-s1-s2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-string-s4-s1-s2"}},[s._v("#")]),s._v(" 1. String s4 = s1 + s2")]),s._v(" "),a("p",[s._v("新增这行代码")]),s._v(" "),a("p",[s._v("表示")]),s._v(" "),a("div",{staticClass:"language-java line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("StringBuilder")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("append")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"a"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("append")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"b"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("toString")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("而toString()方法的源码为")]),s._v(" "),a("div",{staticClass:"language-java line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[s._v("\t"),a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Override")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("toString")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// Create a copy, don't share the array")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("value"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" count"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("p",[s._v("等同于")]),s._v(" "),a("div",{staticClass:"language-java line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ab"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v('s3的"ab"在字符串池中')]),s._v(" "),a("p",[s._v('s4的new String("ab")在堆内存中')]),s._v(" "),a("p",[s._v("故此时")]),s._v(" "),a("p",[a("u",[a("strong",[s._v("s3 == s4")]),s._v("为 "),a("strong",[s._v("false")])])]),s._v(" "),a("h3",{attrs:{id:"_2-string-s5-a-b"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-string-s5-a-b"}},[s._v("#")]),s._v(' 2. String s5 = "a" + "b"')]),s._v(" "),a("p",[s._v("Javac在编译器的优化,在编译期间在确定")]),s._v(" "),a("p",[s._v("故直接从字符串常量池中寻找")]),s._v(" "),a("p",[s._v("此时")]),s._v(" "),a("p",[a("u",[a("strong",[s._v("s3 == s5")]),s._v("为"),a("strong",[s._v("true")])])]),s._v(" "),a("h3",{attrs:{id:"_3-string-s6-ab-和string-s7-new-string-ab-有什么区别"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-string-s6-ab-和string-s7-new-string-ab-有什么区别"}},[s._v("#")]),s._v(' 3.String s6="ab"和String s7=new String("ab")有什么区别?')]),s._v(" "),a("h4",{attrs:{id:"_1-string-s6-ab-直接赋值"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-string-s6-ab-直接赋值"}},[s._v("#")]),s._v(' 1).String s6="ab"直接赋值')]),s._v(" "),a("p",[s._v('如果字符串常量池中已经存在"ab"')]),s._v(" "),a("p",[s._v("则会直接返回其引用")]),s._v(" "),a("p",[s._v("不存在则会创建返回")]),s._v(" "),a("p",[s._v("所以该方法会创建0个或1个对象")]),s._v(" "),a("h4",{attrs:{id:"_2-string-s7-new-string-ab-构造方法"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-string-s7-new-string-ab-构造方法"}},[s._v("#")]),s._v(' 2).String s7=new String("ab")构造方法')]),s._v(" "),a("ol",[a("li",[a("p",[s._v('首先会在堆内存中创建一个String对象,值为"ab"')])]),s._v(" "),a("li",[a("p",[s._v("如果在字符串在字符串常量池中不存在,也会在字符串常量池中创建")])]),s._v(" "),a("li",[a("p",[s._v("返回"),a("strong",[s._v("堆中对象")]),s._v("的引用")])])]),s._v(" "),a("p",[s._v("该方法会创建1个或两个对象")]),s._v(" "),a("h2",{attrs:{id:"三-intern-方法"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#三-intern-方法"}},[s._v("#")]),s._v(" 三. intern()方法")]),s._v(" "),a("div",{staticClass:"language-java line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("static")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("main")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" args"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" s "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"a"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"b"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[s._v('此时StringTable  ["a", "b"]')]),s._v(" "),a("p",[s._v('"a","b","ab"此时存放堆中')]),s._v(" "),a("div",{staticClass:"language-java line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[s._v("s"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("intern")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v('//JDK1.8  将s放进串池中,如果有则不放入,没有则放入,并返回串池对象,地址改变 s == "ab"为true')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v('//JDK1.6  将s放进串池中,如果有则不放入,没有则复制一份放入,并返回串池对象,地址不变 s == "ab"为false')]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("h2",{attrs:{id:"四-内存结构"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#四-内存结构"}},[s._v("#")]),s._v(" 四.内存结构")]),s._v(" "),a("p",[s._v("JDK1.6存放在常量池中,常量池存放在永久代中")]),s._v(" "),a("p",[s._v("JDK1.7存放在堆内存中")]),s._v(" "),a("p",[s._v("原因:")]),s._v(" "),a("p",[s._v("存放在永久代中GC效率太低难以回收,造成大量内存占用导致浪费")]),s._v(" "),a("h2",{attrs:{id:"五-性能调优"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#五-性能调优"}},[s._v("#")]),s._v(" 五.性能调优")]),s._v(" "),a("h3",{attrs:{id:"_1-调整桶个数"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-调整桶个数"}},[s._v("#")]),s._v(" 1. 调整桶个数")]),s._v(" "),a("p",[s._v("StringTable本质是hashtable")]),s._v(" "),a("p",[s._v("调优在hashable的桶的个数上进行增减")]),s._v(" "),a("p",[s._v("使用"),a("code",[s._v("-XX: StringTableSize=200000")]),s._v("进行调整")]),s._v(" "),a("p",[s._v("如果系统中的字符串常量较多,建议增加Hashtable的桶个数")]),s._v(" "),a("h3",{attrs:{id:"_2-考虑是否将字符串对象入池"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-考虑是否将字符串对象入池"}},[s._v("#")]),s._v(" 2.考虑是否将字符串对象入池")]),s._v(" "),a("p",[s._v("使用 **intern()**方法")]),s._v(" "),a("p",[s._v("可以将重复的字符串执行**intern()**方法,减少入池的字符串")])])}),[],!1,null,null,null);a.default=r.exports}}]);