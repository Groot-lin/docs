(window.webpackJsonp=window.webpackJsonp||[]).push([[85],{510:function(_,v,t){"use strict";t.r(v);var e=t(2),s=Object(e.a)({},(function(){var _=this,v=_._self._c;return v("ContentSlotsDistributor",{attrs:{"slot-key":_.$parent.slotKey}},[v("blockquote",[v("p",[_._v("延迟消息 : 生产者发送消息时指定一个时间,消费者不会立刻受到消息,而是在指定事件之后才收到消息")])]),_._v(" "),v("p",[_._v("如 :")]),_._v(" "),v("p",[_._v("用户下单后,迟迟未付款")]),_._v(" "),v("p",[_._v("信息提醒等等")]),_._v(" "),v("p",[_._v("延时消息有三种实现方案")]),_._v(" "),v("p",[_._v("下面我们一一详解")]),_._v(" "),v("h2",{attrs:{id:"一-死信交换机"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#一-死信交换机"}},[_._v("#")]),_._v(" 一.死信交换机")]),_._v(" "),v("p",[v("big",[v("strong",[_._v("什么是死信?")])])],1),_._v(" "),v("p",[_._v("当一个队列中的消息满足下列情况之一时，就会成为"),v("strong",[_._v("死信（dead letter)")]),_._v(" :")]),_._v(" "),v("ul",[v("li",[v("p",[_._v("消费者使用basic.reject或 basic.nack声明消费失败，并且消息的requeue参数设置为false")]),_._v(" "),v("p",[_._v("(简单来说就是消费者不要这个消息了)")])]),_._v(" "),v("li",[v("p",[_._v("消息是一个过期消息（达到了队列或消息本身设置的过期时间），超时无人消费")])]),_._v(" "),v("li",[v("p",[_._v("要投递的队列消息堆积满了，最早的消息可能成为死信")])])]),_._v(" "),v("p",[v("big",[v("strong",[_._v("死信交换机")])])],1),_._v(" "),v("p",[_._v("如果队列通过"),v("strong",[_._v("dead-letter-exchange")]),_._v("属性指定了一个交换机")]),_._v(" "),v("p",[_._v("那么该队列中的死信就会投递到这个交换机中")]),_._v(" "),v("p",[_._v("这个交换机就会被称为"),v("strong",[_._v("死信交换机DLX")])]),_._v(" "),v("p",[v("img",{attrs:{src:"https://18334034784.oss-cn-chengdu.aliyuncs.com/lin-oss/DXL.png",alt:"image-20231124161313091"}})]),_._v(" "),v("p",[_._v("步骤如下 :")]),_._v(" "),v("ol",[v("li",[_._v("生产者设置定时任务TTL=30s")]),_._v(" "),v("li",[_._v("消息来到simple.queue中,等待30s后成为死信")]),_._v(" "),v("li",[_._v("消息来到DXL中,继而传到消费者")])]),_._v(" "),v("p",[_._v("这样就完成了消息的延迟效果")]),_._v(" "),v("h2",{attrs:{id:"二-延迟消息插件"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#二-延迟消息插件"}},[_._v("#")]),_._v(" 二.延迟消息插件")]),_._v(" "),v("p",[_._v("由上我们不难看出")]),_._v(" "),v("p",[_._v("死信交换机这种方式比较繁琐")]),_._v(" "),v("p",[_._v("需要定义多个交换机和队列")]),_._v(" "),v("p",[_._v("于是RabbitMQ官方推出一个插件"),v("font",{attrs:{color:"red"}},[_._v("rabbitmq_delayed_message_exchange")]),_._v(",原生支持延迟消息功能")],1),_._v(" "),v("p",[_._v("该插件的原理是设计了"),v("strong",[_._v("一种支持延迟消息功能的交换机")])]),_._v(" "),v("p",[_._v("当消息投递到交换机后可以暂存一定时间,到期后再投递到队列")]),_._v(" "),v("p",[_._v("添加延迟消息属性单位s:")]),_._v(" "),v("p",[v("code",[_._v("message.getMessageProperties().setDelay(5000);")])]),_._v(" "),v("p",[v("big",[v("strong",[_._v("延迟消息弊端")])])],1),_._v(" "),v("p",[_._v("延迟定时功能大部分都有一定性能损耗")]),_._v(" "),v("p",[_._v("每当定义一个定时任务,内部维护一个时钟")]),_._v(" "),v("p",[_._v("时钟运行过程中,CPU会不断计算")]),_._v(" "),v("p",[v("u",[_._v("故该延时消息适合用于延时时间较短功能")])])])}),[],!1,null,null,null);v.default=s.exports}}]);