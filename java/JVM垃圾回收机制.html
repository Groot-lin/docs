<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>JVM垃圾回收机制 | lin的奇妙冒险</title>
    <meta name="generator" content="VuePress 1.9.10">
    <link rel="icon" href="/docs/logo.jpg">
    <meta name="description" content="lin的奇妙冒险🏡">
    <meta name="referrer" content="no-referrer">
    
    <link rel="preload" href="/docs/assets/css/0.styles.7e5e0118.css" as="style"><link rel="preload" href="/docs/assets/js/app.f6c328c3.js" as="script"><link rel="preload" href="/docs/assets/js/7.2ccd72f8.js" as="script"><link rel="preload" href="/docs/assets/js/2.0ad8144f.js" as="script"><link rel="preload" href="/docs/assets/js/1.487ab7c2.js" as="script"><link rel="preload" href="/docs/assets/js/66.dbe1a90c.js" as="script"><link rel="prefetch" href="/docs/assets/js/10.857c63da.js"><link rel="prefetch" href="/docs/assets/js/11.c2016f4d.js"><link rel="prefetch" href="/docs/assets/js/14.948926a2.js"><link rel="prefetch" href="/docs/assets/js/15.ec015ef1.js"><link rel="prefetch" href="/docs/assets/js/16.2dd5011e.js"><link rel="prefetch" href="/docs/assets/js/17.53e34123.js"><link rel="prefetch" href="/docs/assets/js/18.37b2cdce.js"><link rel="prefetch" href="/docs/assets/js/19.36be9f06.js"><link rel="prefetch" href="/docs/assets/js/20.83748879.js"><link rel="prefetch" href="/docs/assets/js/21.02c7eae3.js"><link rel="prefetch" href="/docs/assets/js/22.5986944e.js"><link rel="prefetch" href="/docs/assets/js/23.7e856d2e.js"><link rel="prefetch" href="/docs/assets/js/24.4d4897f8.js"><link rel="prefetch" href="/docs/assets/js/25.d8b01d6a.js"><link rel="prefetch" href="/docs/assets/js/26.5e2450ee.js"><link rel="prefetch" href="/docs/assets/js/27.70d0d134.js"><link rel="prefetch" href="/docs/assets/js/28.54f2a2e4.js"><link rel="prefetch" href="/docs/assets/js/29.f840c760.js"><link rel="prefetch" href="/docs/assets/js/3.b4707d0b.js"><link rel="prefetch" href="/docs/assets/js/30.5abe6fec.js"><link rel="prefetch" href="/docs/assets/js/31.569f8793.js"><link rel="prefetch" href="/docs/assets/js/32.fc3d1d7d.js"><link rel="prefetch" href="/docs/assets/js/33.038908fe.js"><link rel="prefetch" href="/docs/assets/js/34.35d7ff80.js"><link rel="prefetch" href="/docs/assets/js/35.cd6062e0.js"><link rel="prefetch" href="/docs/assets/js/36.7eb1a2c7.js"><link rel="prefetch" href="/docs/assets/js/37.efaeed6b.js"><link rel="prefetch" href="/docs/assets/js/38.19ac71d2.js"><link rel="prefetch" href="/docs/assets/js/39.edaad5df.js"><link rel="prefetch" href="/docs/assets/js/4.c4cb4f36.js"><link rel="prefetch" href="/docs/assets/js/40.0b03a70f.js"><link rel="prefetch" href="/docs/assets/js/41.54f56ce5.js"><link rel="prefetch" href="/docs/assets/js/42.3111333a.js"><link rel="prefetch" href="/docs/assets/js/43.7ce57408.js"><link rel="prefetch" href="/docs/assets/js/44.5953e9a0.js"><link rel="prefetch" href="/docs/assets/js/45.8d4c5daa.js"><link rel="prefetch" href="/docs/assets/js/46.7cbaee3e.js"><link rel="prefetch" href="/docs/assets/js/47.3c4e8d46.js"><link rel="prefetch" href="/docs/assets/js/48.188f9cf0.js"><link rel="prefetch" href="/docs/assets/js/49.a69ce0e2.js"><link rel="prefetch" href="/docs/assets/js/5.2d6199dc.js"><link rel="prefetch" href="/docs/assets/js/50.b585548b.js"><link rel="prefetch" href="/docs/assets/js/51.a4d7c40a.js"><link rel="prefetch" href="/docs/assets/js/52.93d3bd67.js"><link rel="prefetch" href="/docs/assets/js/53.3ab07fdf.js"><link rel="prefetch" href="/docs/assets/js/54.6e4ad258.js"><link rel="prefetch" href="/docs/assets/js/55.bfbb8c38.js"><link rel="prefetch" href="/docs/assets/js/56.3fd9fbe3.js"><link rel="prefetch" href="/docs/assets/js/57.29e5c42f.js"><link rel="prefetch" href="/docs/assets/js/58.43596da1.js"><link rel="prefetch" href="/docs/assets/js/59.ed2a66f3.js"><link rel="prefetch" href="/docs/assets/js/6.ef8c328d.js"><link rel="prefetch" href="/docs/assets/js/60.e42e9368.js"><link rel="prefetch" href="/docs/assets/js/61.41bbc5d7.js"><link rel="prefetch" href="/docs/assets/js/62.b850fee0.js"><link rel="prefetch" href="/docs/assets/js/63.83b9dfbd.js"><link rel="prefetch" href="/docs/assets/js/64.91831f46.js"><link rel="prefetch" href="/docs/assets/js/65.829e9d2b.js"><link rel="prefetch" href="/docs/assets/js/67.23951580.js"><link rel="prefetch" href="/docs/assets/js/68.56bbbfe3.js"><link rel="prefetch" href="/docs/assets/js/69.b8908ee3.js"><link rel="prefetch" href="/docs/assets/js/70.0ca7ec87.js"><link rel="prefetch" href="/docs/assets/js/71.c5da3b1b.js"><link rel="prefetch" href="/docs/assets/js/72.a6ed3a33.js"><link rel="prefetch" href="/docs/assets/js/73.a2319e63.js"><link rel="prefetch" href="/docs/assets/js/74.cca8a541.js"><link rel="prefetch" href="/docs/assets/js/75.63a73811.js"><link rel="prefetch" href="/docs/assets/js/76.37666abc.js"><link rel="prefetch" href="/docs/assets/js/77.a5de9ead.js"><link rel="prefetch" href="/docs/assets/js/78.b51236ca.js"><link rel="prefetch" href="/docs/assets/js/79.74a1cb03.js"><link rel="prefetch" href="/docs/assets/js/8.2620b1c9.js"><link rel="prefetch" href="/docs/assets/js/80.798c0402.js"><link rel="prefetch" href="/docs/assets/js/81.dae6192f.js"><link rel="prefetch" href="/docs/assets/js/82.98897947.js"><link rel="prefetch" href="/docs/assets/js/83.b2851a2e.js"><link rel="prefetch" href="/docs/assets/js/84.7a64f924.js"><link rel="prefetch" href="/docs/assets/js/85.831d0e16.js"><link rel="prefetch" href="/docs/assets/js/86.607c6f9c.js"><link rel="prefetch" href="/docs/assets/js/9.31e78a46.js"><link rel="prefetch" href="/docs/assets/js/vendors~docsearch.ea1f12ce.js">
    <link rel="stylesheet" href="/docs/assets/css/0.styles.7e5e0118.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container" data-v-7dd95ae2><div data-v-7dd95ae2><div class="password-shadow password-wrapper-out" style="display:none;" data-v-59e6cb88 data-v-7dd95ae2 data-v-7dd95ae2><h3 class="title" data-v-59e6cb88>lin的奇妙冒险</h3> <p class="description" data-v-59e6cb88>lin的奇妙冒险🏡</p> <label id="box" class="inputBox" data-v-59e6cb88><input type="password" value="" data-v-59e6cb88> <span data-v-59e6cb88>Konck! Knock!</span> <button data-v-59e6cb88>OK</button></label> <div class="footer" data-v-59e6cb88><span data-v-59e6cb88><i class="iconfont reco-theme" data-v-59e6cb88></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-59e6cb88>vuePress-theme-reco</a></span> <span data-v-59e6cb88><i class="iconfont reco-copyright" data-v-59e6cb88></i> <a data-v-59e6cb88><!---->
          
        <!---->
        2024
      </a></span></div></div> <div class="hide" data-v-7dd95ae2><header class="navbar" data-v-7dd95ae2><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/docs/" class="home-link router-link-active"><!----> <span class="site-name">lin的奇妙冒险</span></a> <div class="links"><div class="color-picker"><a class="color-button"><i class="iconfont reco-color"></i></a> <div class="color-picker-menu" style="display:none;"><div class="mode-options"><h4 class="title">Choose mode</h4> <ul class="color-mode-options"><li class="dark">dark</li><li class="auto active">auto</li><li class="light">light</li></ul></div></div></div> <div class="search-box"><i class="iconfont reco-search"></i> <input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/docs/" class="nav-link"><i class="iconfont icon-home"></i>
  首页
</a></div><div class="nav-item"><a href="/docs/tag/" class="nav-link"><i class="iconfont reco-document"></i>
  文章
</a></div><div class="nav-item"><a href="/docs/java/" class="nav-link router-link-active"><i class="iconfont icon-java"></i>
  Java基础
</a></div><div class="nav-item"><a href="/docs/computer/" class="nav-link"><i class="undefined"></i>
  计算机基础
</a></div><div class="nav-item"><a href="/docs/database/" class="nav-link"><i class="undefined"></i>
  数据库
</a></div><div class="nav-item"><a href="/docs/technology/" class="nav-link"><i class="undefined"></i>
  技术栈
</a></div><div class="nav-item"><a href="/docs/contact/" class="nav-link"><i class="iconfont icon-dianhua"></i>
  与我探讨
</a></div><div class="nav-item"><a href="https://github.com/Groot-lin" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont icon-github"></i>
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask" data-v-7dd95ae2></div> <aside class="sidebar" data-v-7dd95ae2><div class="personal-info-wrapper" data-v-1fad0c41 data-v-7dd95ae2><!----> <!----> <div class="num" data-v-1fad0c41><div data-v-1fad0c41><h3 data-v-1fad0c41>47</h3> <h6 data-v-1fad0c41>文章</h6></div> <div data-v-1fad0c41><h3 data-v-1fad0c41>14</h3> <h6 data-v-1fad0c41>标签</h6></div></div> <ul class="social-links" data-v-1fad0c41></ul> <hr data-v-1fad0c41></div> <nav class="nav-links"><div class="nav-item"><a href="/docs/" class="nav-link"><i class="iconfont icon-home"></i>
  首页
</a></div><div class="nav-item"><a href="/docs/tag/" class="nav-link"><i class="iconfont reco-document"></i>
  文章
</a></div><div class="nav-item"><a href="/docs/java/" class="nav-link router-link-active"><i class="iconfont icon-java"></i>
  Java基础
</a></div><div class="nav-item"><a href="/docs/computer/" class="nav-link"><i class="undefined"></i>
  计算机基础
</a></div><div class="nav-item"><a href="/docs/database/" class="nav-link"><i class="undefined"></i>
  数据库
</a></div><div class="nav-item"><a href="/docs/technology/" class="nav-link"><i class="undefined"></i>
  技术栈
</a></div><div class="nav-item"><a href="/docs/contact/" class="nav-link"><i class="iconfont icon-dianhua"></i>
  与我探讨
</a></div><div class="nav-item"><a href="https://github.com/Groot-lin" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont icon-github"></i>
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav> <ul class="sidebar-links"><li><a href="/docs/java/" aria-current="page" class="sidebar-link">Java导航</a></li><li><a href="/docs/java/多线程详解.html" class="sidebar-link">多线程详解</a></li><li><a href="/docs/java/JVM内存结构.html" class="sidebar-link">JVM内存结构</a></li><li><a href="/docs/java/JVM垃圾回收机制.html" class="active sidebar-link">JVM垃圾回收机制</a></li><li><a href="/docs/java/JVM类加载机制.html" class="sidebar-link">JVM类加载机制</a></li><li><a href="/docs/java/StringTable详解.html" class="sidebar-link">StringTable详解</a></li><li><a href="/docs/java/Java内存模型-JMM.html" class="sidebar-link">Java内存模型-JMM</a></li><li><a href="/docs/java/Lambda与Stream流.html" class="sidebar-link">Lambda与Stream流</a></li><li><a href="/docs/java/ThreadLocal与AQS.html" class="sidebar-link">ThreadLocal与AQS</a></li><li><a href="/docs/java/IOC详解.html" class="sidebar-link">IOC详解</a></li><li><a href="/docs/java/Bean生命周期.html" class="sidebar-link">Bean生命周期</a></li><li><a href="/docs/java/AOP详解.html" class="sidebar-link">AOP详解</a></li><li><a href="/docs/java/Spring事务.html" class="sidebar-link">Spring事务</a></li><li><a href="/docs/java/SpringBoot原理分析.html" class="sidebar-link">SpringBoot原理分析</a></li><li><a href="/docs/java/SpringBoot启动流程.html" class="sidebar-link">SpringBoot启动流程</a></li></ul> </aside> <div class="password-shadow password-wrapper-in" style="display:none;" data-v-59e6cb88 data-v-7dd95ae2><h3 class="title" data-v-59e6cb88>JVM垃圾回收机制</h3> <!----> <label id="box" class="inputBox" data-v-59e6cb88><input type="password" value="" data-v-59e6cb88> <span data-v-59e6cb88>Konck! Knock!</span> <button data-v-59e6cb88>OK</button></label> <div class="footer" data-v-59e6cb88><span data-v-59e6cb88><i class="iconfont reco-theme" data-v-59e6cb88></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-59e6cb88>vuePress-theme-reco</a></span> <span data-v-59e6cb88><i class="iconfont reco-copyright" data-v-59e6cb88></i> <a data-v-59e6cb88><!---->
          
        <!---->
        2024
      </a></span></div></div> <div data-v-7dd95ae2><div data-v-7dd95ae2><main class="page"><section style="display:;"><div class="page-title"><h1 class="title">JVM垃圾回收机制</h1> <div data-v-8a445198><i class="iconfont reco-account" data-v-8a445198><span data-v-8a445198>lin</span></i> <i class="iconfont reco-date" data-v-8a445198><span data-v-8a445198>2023/9/25</span></i> <!----> <i class="tags iconfont reco-tag" data-v-8a445198><span class="tag-item" data-v-8a445198>JVM</span></i></div></div> <div class="theme-reco-content content__default"><h2 id="一-如何判断对象是否可以回收"><a href="#一-如何判断对象是否可以回收" class="header-anchor">#</a> 一.如何判断对象是否可以回收</h2> <h3 id="_1-引用计数法"><a href="#_1-引用计数法" class="header-anchor">#</a> 1.引用计数法</h3> <p>如果一个对象被引用,则计数器+1</p> <p>当引用失效时，引用计数器就减1</p> <p>当对象计数器为0时,回收对象</p> <p>但是如果</p> <p>两个对象相互循环引用,则无法被回收</p> <h3 id="_2-可达性分析算法"><a href="#_2-可达性分析算法" class="header-anchor">#</a> 2.可达性分析算法</h3> <p>JVM 中的<strong>垃圾回收器</strong>采用可达性分析来探索所有存活的对象</p> <p>在堆中进行扫描</p> <p>看看是否能沿着GC Root对象为起点的引用链找到该对象</p> <p>如果一个对象没有被根对象直接或间接引用,那就可以被当成垃圾回收</p> <p>哪些类可以作为GC Root对象?</p> <ul><li>System Class 如 Object,HashMap,System,String等</li> <li>Native Stack 操作系统方法</li> <li>Thread 活动线程对象</li> <li>Busy Monitor 被加锁的对象不会被回收</li></ul> <h2 id="二-jvm-引用"><a href="#二-jvm-引用" class="header-anchor">#</a> 二.JVM 引用</h2> <p>软弱虚引用本身是一个对象</p> <h3 id="_1-强引用"><a href="#_1-强引用" class="header-anchor">#</a> 1.强引用</h3> <p>最普遍的引用大部分引用都是强引用</p> <p>如</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">Object</span> object <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>JVM不会回收此类对象</p> <p>如果想清理内存,可以将该值设为null</p> <h3 id="_2-软引用-softreference"><a href="#_2-软引用-softreference" class="header-anchor">#</a> 2.软引用 SoftReference</h3> <p>对象A --&gt; 软引用 --&gt; 对象B</p> <p>软引用是用来描述一些<strong>有用但并不是必需</strong>的对象</p> <p>只有在<strong>内存不足</strong>且<strong>进行垃圾回收</strong>的时候JVM才会回收该对象</p> <p>可以应用在网页缓存,图片缓存上</p> <p>清理软引用</p> <p>关联引用队列,当软引用所关联的对象被回收时,软引用本身会加入到queue中</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">ReferenceQueue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span> queue <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ReferenceQueue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="_3-弱引用-softreference"><a href="#_3-弱引用-softreference" class="header-anchor">#</a> 3.弱引用 SoftReference</h3> <p>弱引用也是用来描述<strong>非必需对象</strong>的</p> <p>当JVM进行垃圾回收时，无论内存是否充足，<strong>都会回收被弱引用关联的对象</strong></p> <h3 id="_4-虚引用"><a href="#_4-虚引用" class="header-anchor">#</a> 4.虚引用</h3> <p>虚引用必须和引用队列关联使用，当垃圾回收器准备回收一个对象时</p> <p>如果发现它还有虚引用，就会把这个<strong>虚引用加入到与之关联的引用队列中</strong></p> <p>可以通过判断引用队列中是否已经加入了虚引用</p> <p>由Refernce Handler线程调用虚引用相关方法释放直接内存</p> <h2 id="三-垃圾回收算法"><a href="#三-垃圾回收算法" class="header-anchor">#</a> 三.垃圾回收算法</h2> <h3 id="_1-标记清除算法"><a href="#_1-标记清除算法" class="header-anchor">#</a> 1.标记清除算法</h3> <p>步骤:</p> <ol><li><strong>标记</strong>: 垃圾回收器从引用根节点开始遍历被引用的对象.一般是在Header中记录为可达对象</li> <li><strong>清除</strong>: 垃圾回收器从堆内存从头到尾进行线性的便利,如果发现某个对象没有被标记,则进行回收</li></ol> <p><strong>如何清除?</strong></p> <p>把需要清除对象地址保存在空闲的地址列表.</p> <p>下次有新对象需要加载时,判断垃圾的位置空间是否足够</p> <p>如果够则覆盖原有的位置</p> <ul><li><p><strong>优点</strong>是速度快</p></li> <li><p><strong>缺点</strong>是容易产生内存碎片</p></li></ul> <h3 id="_2-标记整理算法"><a href="#_2-标记整理算法" class="header-anchor">#</a> 2.标记整理算法</h3> <p>步骤:</p> <ol><li><strong>标记</strong>: 垃圾回收器从引用根节点开始遍历被引用的对象.一般是在Header中记录为可达对象</li> <li><strong>整理</strong>: 将所有存活对象压缩到内存的一段,之后清理边界外所有的空间</li></ol> <ul><li><p>不会产生较大的内存碎片</p></li> <li><p>但是涉及到内存地址改变,效率较低</p></li></ul> <h3 id="_3-复制算法"><a href="#_3-复制算法" class="header-anchor">#</a> 3.复制算法</h3> <p>将内存区域划分成两块</p> <table><thead><tr><th style="text-align:center;">FROM</th> <th style="text-align:center;">To</th></tr></thead> <tbody></tbody></table> <p>其中FROM区域存放对象,To区域始终空闲</p> <p>首先在FROM区域中进行标记</p> <p>将FROM中存活的对象放在TO区域中</p> <p>接着清除FROM区域中的垃圾</p> <p>最后交换两块区域</p> <ul><li>不会有内存碎片</li> <li>但需要两倍的内存空间</li></ul> <h2 id="四-分代回收算法"><a href="#四-分代回收算法" class="header-anchor">#</a> 四.分代回收算法</h2> <p>Java虚拟机根据对象存货周期不同,把<strong>堆内存</strong>划分为几块</p> <p>一般分为<strong>新生代</strong>,<strong>老年代</strong>,在HotSpot中还有<strong>永久代</strong></p> <p><img src="https://18334034784.oss-cn-chengdu.aliyuncs.com/lin-oss/%E6%96%B0%E7%94%9F%E4%BB%A3.png" alt="image-20230924213403553"></p> <p>大小比例为 8 : 1 : 1</p> <ul><li>大部分刚刚被创建的对象存放在<strong>Eden区</strong></li> <li>当 Eden区满了以后,触发<strong>Minor GC</strong>,使用<strong>复制算法</strong>将存活对象放在From区.将From区的对象计数为1</li> <li>Minor GC时,会引发<strong>stop the world</strong>,暂停当前用户正在执行的方法</li> <li>第二次满以后继续触发GC,将<strong>From区</strong>的对象计数为2,当达到阈值(默认为15-4bit)以后晋升<strong>老年代</strong>中</li> <li>当老年代空间不足时,先尝试触发<strong>Minor GC</strong>,再触发<strong>Full GC</strong>,清理新生代到老年代垃圾</li> <li>大对象直接晋升老年代</li></ul> <h2 id="五-gc参数"><a href="#五-gc参数" class="header-anchor">#</a> 五.GC参数</h2> <table><thead><tr><th style="text-align:center;">含义</th> <th style="text-align:center;">参数</th></tr></thead> <tbody><tr><td style="text-align:center;">堆初始大小</td> <td style="text-align:center;">-Xms</td></tr> <tr><td style="text-align:center;">堆最大大小</td> <td style="text-align:center;">-Xmx</td></tr> <tr><td style="text-align:center;">新生代大小</td> <td style="text-align:center;">-Xmn</td></tr> <tr><td style="text-align:center;">幸存区比例(动态)</td> <td style="text-align:center;">-XX:InitialSurvorRatio=ratio</td></tr> <tr><td style="text-align:center;">幸存区比例</td> <td style="text-align:center;">-XX:SurvorRatio=ratio</td></tr> <tr><td style="text-align:center;">晋升阈值</td> <td style="text-align:center;">-XX:MaxTenuringThreshold=threshold</td></tr> <tr><td style="text-align:center;">晋升详情</td> <td style="text-align:center;">-XX:+PrintTenuringDistribution</td></tr> <tr><td style="text-align:center;">GC详情</td> <td style="text-align:center;">-XX:+PrintGCDetails -verbose:gc</td></tr> <tr><td style="text-align:center;">FullGC 前 MinorGC</td> <td style="text-align:center;">-XX:ScavengeBeforeFullGC</td></tr></tbody></table> <h2 id="六-垃圾回收器"><a href="#六-垃圾回收器" class="header-anchor">#</a> 六.垃圾回收器</h2> <p>垃圾回收器是垃圾回收算法的具体实现</p> <h3 id="_1-serial串行垃圾回收器"><a href="#_1-serial串行垃圾回收器" class="header-anchor">#</a> 1.Serial串行垃圾回收器</h3> <ul><li>单线程</li> <li>堆内存较小,适合个人电脑</li> <li>Serial只会使用一个CPU或者一条GC线程进行垃圾回收，并且在线程到达安全点时暂停其他工作线程</li> <li>新生代使用复制算法,老年代使用标记整理算法</li></ul> <p>使用参数命令开启</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token operator">-</span><span class="token constant">XX</span><span class="token operator">:</span> <span class="token operator">+</span><span class="token class-name">UseSerialGC</span><span class="token operator">=</span><span class="token class-name">Serial</span> <span class="token operator">+</span> <span class="token class-name">SerialOld</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="_2-parallelgc并行垃圾回收器"><a href="#_2-parallelgc并行垃圾回收器" class="header-anchor">#</a> 2. ParallelGC并行垃圾回收器</h3> <ul><li>多线程</li> <li>吞吐量大</li> <li>堆内存较大,多核cpu</li> <li>尽可能让单次<strong>STW</strong>(Stop the world)的次数最少</li> <li>新生代使用复制算法,老年代使用标记整理算法</li></ul> <p>使用参数命令开启</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token operator">-</span><span class="token constant">XX</span><span class="token operator">:</span> <span class="token operator">+</span><span class="token class-name">UseParallelGC</span> <span class="token comment">//开启</span>
<span class="token operator">-</span><span class="token constant">XX</span><span class="token operator">:</span> <span class="token operator">+</span><span class="token class-name">UserAdaptiveSizePolicy</span> <span class="token comment">//通过命令就能开启GC 自适应的调节策略(区别于ParNew).</span>
<span class="token operator">+</span><span class="token constant">XX</span><span class="token operator">:</span> <span class="token class-name">GCTimeRatio</span><span class="token operator">=</span>ratio <span class="token comment">//调整吞吐量大小,GC时间占总时间比率</span>
<span class="token operator">+</span><span class="token constant">XX</span><span class="token operator">:</span> <span class="token class-name">MaxGCpauseMillis</span><span class="token operator">=</span>ms<span class="token comment">//暂停时间最大毫秒数</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>到达安全点多个线程同时进行垃圾回收</p> <h3 id="_3-cms垃圾回收器"><a href="#_3-cms垃圾回收器" class="header-anchor">#</a> 3.CMS垃圾回收器</h3> <p>CMS作用于老年代，是一种以获取最短停顿时间为目标的收集器。给予标记-清除算法实现</p> <h4 id="特点"><a href="#特点" class="header-anchor">#</a> 特点</h4> <ul><li>多线程</li> <li>吞吐量低</li> <li>堆内存较大,多核cpu</li> <li>尽可能让单次STW的时间最短</li> <li>使用标记-清除算法</li></ul> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token operator">-</span><span class="token constant">XX</span><span class="token operator">:</span> <span class="token operator">+</span><span class="token class-name">ParalleGCThreads</span><span class="token operator">=</span>n <span class="token comment">//并发GC线程数</span>
<span class="token operator">-</span><span class="token constant">XX</span><span class="token operator">:</span> <span class="token class-name">CMSInitiatingOccupancyFraction</span><span class="token operator">=</span>parent<span class="token comment">//设置CMS触发时机 </span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><img src="https://18334034784.oss-cn-chengdu.aliyuncs.com/lin-oss/%E5%93%8D%E5%BA%94%E6%97%B6%E9%97%B4%E4%BC%98%E5%85%88%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6%E5%99%A8.png" alt="image-20230925164543603"></p> <h4 id="步骤"><a href="#步骤" class="header-anchor">#</a> 步骤</h4> <p>1.初始标记
停止一切用户线程，因使用一条初始标记线程对所有与GC Roots关联的对象进行标记。
2.并发标记
使用多条并发标记线程并行执行，并与用户线程并发执行。此过程进行可达性分析，标记出所有废弃的对象，速度很慢。
3.重新标记
使用多条线程并行执行，将刚才并发过程中新出现的废弃对象标出来。
4.并发清除
使用一条并发清除线程，和业务线程并发执行，清除无用对象，这个过程非常耗时。此时可能会产生浮动垃圾</p> <h2 id="七-g1垃圾回收器"><a href="#七-g1垃圾回收器" class="header-anchor">#</a> 七.G1垃圾回收器</h2> <h3 id="_1-g1"><a href="#_1-g1" class="header-anchor">#</a> 1.G1</h3> <p>①. G1(Garbage-First)是一款面向服务端应用的垃圾收集器,主要针对配备多核CPU及大容量内存的机器,<strong>以极高概率满足GC停顿时间的同时</strong>,还<strong>兼具高吞吐量的性能特征</strong></p> <p>②. 在JDK1.7版本正式启用,是<strong>JDK 9以后的默认垃圾收集器,取代了CMS 回收器</strong>。</p> <p>使用场景:</p> <ul><li>同时注重吞吐量和低延迟,默认的暂停量是200ms</li> <li>超大堆内存,会将堆划分为多个大小相等的Region,用来表示Eden,s0,s1,old区等</li> <li>整体上是<strong>标记整理</strong>算法,两个区域直接按是<strong>复制</strong>算法</li></ul> <h3 id="_2-参数"><a href="#_2-参数" class="header-anchor">#</a> 2.参数</h3> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token operator">-</span><span class="token constant">XX</span><span class="token operator">:</span><span class="token class-name">G1HeapRegionSize</span><span class="token operator">=</span>size<span class="token comment">//设置Region区域大小,增加标记速度</span>
<span class="token operator">-</span><span class="token constant">XX</span><span class="token operator">:</span><span class="token class-name">MaxGCPauseMillis</span><span class="token comment">//设置期望达到的最大GC停顿时间指标</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="_3-分区region"><a href="#_3-分区region" class="header-anchor">#</a> 3.分区Region</h3> <p><img src="https://18334034784.oss-cn-chengdu.aliyuncs.com/lin-oss/G1%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6%E5%99%A8.png" alt="image-20230925174058171"></p> <ul><li><p>G1垃圾收集器还增加了一种新的内存区域，叫做<strong>Humongous内存区域</strong>，如图中的H块。主要用于存储大对象，如果<strong>超过1.5个region, 就放到H</strong>。</p></li> <li><p>内存的回收是<strong>以region作为基本单位的</strong>。Region之间是复制算法,但整体上实际可看作是<strong>标记一压缩(Mark一Compact)算法</strong>,两种算法都可以避免内存碎片。这种特性有利于程序长时间运行,分配大对象时不会因为无法找到连续内存空间而提前触发下一次GC。尤其是当Java堆非常大的时候,G1的优势更加明显)</p></li></ul> <h3 id="_4-垃圾回收阶段"><a href="#_4-垃圾回收阶段" class="header-anchor">#</a> 4.垃圾回收阶段</h3> <h4 id="_1-新生代回收"><a href="#_1-新生代回收" class="header-anchor">#</a> 1).新生代回收</h4> <ul><li><strong>当Eden空间耗尽时,G1会启动一次年轻代垃圾回收过程</strong></li> <li><strong>年轻代垃圾回收只会回收Eden区和Survivor区</strong></li></ul> <p>阶段</p> <ol><li>根扫描
<ul><li>考虑<strong>remembered Set</strong>,看是否由老年代中的对象引用了新生代对象</li> <li>根是指static变量指向的对象,正在执行的方法调用链条上的局部变量等</li></ul></li> <li>更新RSet</li></ol> <p>此阶段完成后,Rest可以准确的反映老年代对所在的内存分段中对象的引用</p> <ol start="3"><li>处理RSet
<ul><li>识别被老年代对象指向的Eden中的对象,这些被只想的Eden中的对象被认为是存活的对象</li></ul></li> <li>复制对象</li></ol> <p>Eden区 内存段中<strong>存活的对象</strong>会被<strong>复制</strong>到<strong>Survivor区中空的内存分段</strong>,Survivor区内存段中<strong>存活的对象如果年龄未达阈值</strong>,年龄会加1,<strong>达到阀值会被会被复制到old区中空的内存分段</strong>。如果<strong>Survivor空间不够,Eden空间的部分数据会直接晋升到老年代空间</strong></p> <h4 id="_2-老年代并发标记过程"><a href="#_2-老年代并发标记过程" class="header-anchor">#</a> 2).老年代并发标记过程</h4> <ol><li><p>在YoungGC时会进行GC Root的初始标记,STW,并触发一次<strong>Minor GC</strong></p></li> <li><p>老年代占用堆内存比例大道阈值时,进行并发标记(不会STW),由下面的JVM参数决定</p></li></ol> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token operator">-</span><span class="token constant">XX</span><span class="token operator">:</span><span class="token class-name">InitiatingHeadOccupancyPercent</span><span class="token operator">=</span><span class="token function">percent</span><span class="token punctuation">(</span>默认<span class="token number">45</span><span class="token operator">%</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ol start="3"><li>再次标记修正上一次的结果</li> <li>识别可以混合回收的区域.</li> <li>识别并清理完全空闲的区域</li></ol> <h4 id="_3-混合收集"><a href="#_3-混合收集" class="header-anchor">#</a> 3).混合收集</h4> <p>对Eden,survivor,old区进行全面垃圾回收,主要采用复制算法</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token operator">-</span><span class="token constant">XX</span><span class="token operator">:</span><span class="token class-name">MaxGCPauseeMillis</span><span class="token operator">=</span>ms <span class="token comment">//最大暂停时间</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>GC从老年区间移动存活对象到空闲区间,这些空闲区间也就成为了老年代的一部分</p></div></section> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev"><a href="/docs/java/JVM内存结构.html" class="prev">
          JVM内存结构
        </a></span> <span class="next"><a href="/docs/java/JVM类加载机制.html">
          JVM类加载机制
        </a></span></p></div> <div class="comments-wrapper"><!----></div></main></div> <!----></div> <ul class="sub-sidebar sub-sidebar-wrapper" style="width:12rem;" data-v-b57cc07c data-v-7dd95ae2><li class="level-2" data-v-b57cc07c><a href="/docs/java/JVM%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6%E6%9C%BA%E5%88%B6.html#一-如何判断对象是否可以回收" class="sidebar-link reco-side-一-如何判断对象是否可以回收" data-v-b57cc07c>一.如何判断对象是否可以回收</a></li><li class="level-3" data-v-b57cc07c><a href="/docs/java/JVM%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6%E6%9C%BA%E5%88%B6.html#_1-引用计数法" class="sidebar-link reco-side-_1-引用计数法" data-v-b57cc07c>1.引用计数法</a></li><li class="level-3" data-v-b57cc07c><a href="/docs/java/JVM%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6%E6%9C%BA%E5%88%B6.html#_2-可达性分析算法" class="sidebar-link reco-side-_2-可达性分析算法" data-v-b57cc07c>2.可达性分析算法</a></li><li class="level-2" data-v-b57cc07c><a href="/docs/java/JVM%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6%E6%9C%BA%E5%88%B6.html#二-jvm-引用" class="sidebar-link reco-side-二-jvm-引用" data-v-b57cc07c>二.JVM 引用</a></li><li class="level-3" data-v-b57cc07c><a href="/docs/java/JVM%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6%E6%9C%BA%E5%88%B6.html#_1-强引用" class="sidebar-link reco-side-_1-强引用" data-v-b57cc07c>1.强引用</a></li><li class="level-3" data-v-b57cc07c><a href="/docs/java/JVM%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6%E6%9C%BA%E5%88%B6.html#_2-软引用-softreference" class="sidebar-link reco-side-_2-软引用-softreference" data-v-b57cc07c>2.软引用 SoftReference</a></li><li class="level-3" data-v-b57cc07c><a href="/docs/java/JVM%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6%E6%9C%BA%E5%88%B6.html#_3-弱引用-softreference" class="sidebar-link reco-side-_3-弱引用-softreference" data-v-b57cc07c>3.弱引用 SoftReference</a></li><li class="level-3" data-v-b57cc07c><a href="/docs/java/JVM%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6%E6%9C%BA%E5%88%B6.html#_4-虚引用" class="sidebar-link reco-side-_4-虚引用" data-v-b57cc07c>4.虚引用</a></li><li class="level-2" data-v-b57cc07c><a href="/docs/java/JVM%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6%E6%9C%BA%E5%88%B6.html#三-垃圾回收算法" class="sidebar-link reco-side-三-垃圾回收算法" data-v-b57cc07c>三.垃圾回收算法</a></li><li class="level-3" data-v-b57cc07c><a href="/docs/java/JVM%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6%E6%9C%BA%E5%88%B6.html#_1-标记清除算法" class="sidebar-link reco-side-_1-标记清除算法" data-v-b57cc07c>1.标记清除算法</a></li><li class="level-3" data-v-b57cc07c><a href="/docs/java/JVM%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6%E6%9C%BA%E5%88%B6.html#_2-标记整理算法" class="sidebar-link reco-side-_2-标记整理算法" data-v-b57cc07c>2.标记整理算法</a></li><li class="level-3" data-v-b57cc07c><a href="/docs/java/JVM%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6%E6%9C%BA%E5%88%B6.html#_3-复制算法" class="sidebar-link reco-side-_3-复制算法" data-v-b57cc07c>3.复制算法</a></li><li class="level-2" data-v-b57cc07c><a href="/docs/java/JVM%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6%E6%9C%BA%E5%88%B6.html#四-分代回收算法" class="sidebar-link reco-side-四-分代回收算法" data-v-b57cc07c>四.分代回收算法</a></li><li class="level-2" data-v-b57cc07c><a href="/docs/java/JVM%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6%E6%9C%BA%E5%88%B6.html#五-gc参数" class="sidebar-link reco-side-五-gc参数" data-v-b57cc07c>五.GC参数</a></li><li class="level-2" data-v-b57cc07c><a href="/docs/java/JVM%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6%E6%9C%BA%E5%88%B6.html#六-垃圾回收器" class="sidebar-link reco-side-六-垃圾回收器" data-v-b57cc07c>六.垃圾回收器</a></li><li class="level-3" data-v-b57cc07c><a href="/docs/java/JVM%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6%E6%9C%BA%E5%88%B6.html#_1-serial串行垃圾回收器" class="sidebar-link reco-side-_1-serial串行垃圾回收器" data-v-b57cc07c>1.Serial串行垃圾回收器</a></li><li class="level-3" data-v-b57cc07c><a href="/docs/java/JVM%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6%E6%9C%BA%E5%88%B6.html#_2-parallelgc并行垃圾回收器" class="sidebar-link reco-side-_2-parallelgc并行垃圾回收器" data-v-b57cc07c>2. ParallelGC并行垃圾回收器</a></li><li class="level-3" data-v-b57cc07c><a href="/docs/java/JVM%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6%E6%9C%BA%E5%88%B6.html#_3-cms垃圾回收器" class="sidebar-link reco-side-_3-cms垃圾回收器" data-v-b57cc07c>3.CMS垃圾回收器</a></li><li class="level-2" data-v-b57cc07c><a href="/docs/java/JVM%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6%E6%9C%BA%E5%88%B6.html#七-g1垃圾回收器" class="sidebar-link reco-side-七-g1垃圾回收器" data-v-b57cc07c>七.G1垃圾回收器</a></li><li class="level-3" data-v-b57cc07c><a href="/docs/java/JVM%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6%E6%9C%BA%E5%88%B6.html#_1-g1" class="sidebar-link reco-side-_1-g1" data-v-b57cc07c>1.G1</a></li><li class="level-3" data-v-b57cc07c><a href="/docs/java/JVM%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6%E6%9C%BA%E5%88%B6.html#_2-参数" class="sidebar-link reco-side-_2-参数" data-v-b57cc07c>2.参数</a></li><li class="level-3" data-v-b57cc07c><a href="/docs/java/JVM%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6%E6%9C%BA%E5%88%B6.html#_3-分区region" class="sidebar-link reco-side-_3-分区region" data-v-b57cc07c>3.分区Region</a></li><li class="level-3" data-v-b57cc07c><a href="/docs/java/JVM%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6%E6%9C%BA%E5%88%B6.html#_4-垃圾回收阶段" class="sidebar-link reco-side-_4-垃圾回收阶段" data-v-b57cc07c>4.垃圾回收阶段</a></li></ul></div></div></div><div class="global-ui"><div class="back-to-ceiling" style="right:1rem;bottom:6rem;width:2.5rem;height:2.5rem;border-radius:.25rem;line-height:2.5rem;display:none;" data-v-c6073ba8 data-v-c6073ba8><svg t="1574745035067" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5404" class="icon" data-v-c6073ba8><path d="M526.60727968 10.90185116a27.675 27.675 0 0 0-29.21455937 0c-131.36607665 82.28402758-218.69155461 228.01873535-218.69155402 394.07834331a462.20625001 462.20625001 0 0 0 5.36959153 69.94390903c1.00431239 6.55289093-0.34802892 13.13561351-3.76865779 18.80351572-32.63518765 54.11355614-51.75690182 118.55860487-51.7569018 187.94566865a371.06718723 371.06718723 0 0 0 11.50484808 91.98906777c6.53300375 25.50556257 41.68394495 28.14064038 52.69160883 4.22606766 17.37162448-37.73630017 42.14135425-72.50938081 72.80769204-103.21549295 2.18761121 3.04276886 4.15646224 6.24463696 6.40373557 9.22774369a1871.4375 1871.4375 0 0 0 140.04691725 5.34970492 1866.36093723 1866.36093723 0 0 0 140.04691723-5.34970492c2.24727335-2.98310674 4.21612437-6.18497483 6.3937923-9.2178004 30.66633723 30.70611158 55.4360664 65.4791928 72.80769147 103.21549355 11.00766384 23.91457269 46.15860503 21.27949489 52.69160879-4.22606768a371.15156223 371.15156223 0 0 0 11.514792-91.99901164c0-69.36717486-19.13165746-133.82216804-51.75690182-187.92578088-3.42062944-5.66790279-4.76302748-12.26056868-3.76865837-18.80351632a462.20625001 462.20625001 0 0 0 5.36959269-69.943909c-0.00994388-166.08943902-87.32547796-311.81420293-218.6915546-394.09823051zM605.93803103 357.87693858a93.93749974 93.93749974 0 1 1-187.89594924 6.1e-7 93.93749974 93.93749974 0 0 1 187.89594924-6.1e-7z" p-id="5405" data-v-c6073ba8></path><path d="M429.50777625 765.63860547C429.50777625 803.39355007 466.44236686 1000.39046097 512.00932183 1000.39046097c45.56695499 0 82.4922232-197.00623328 82.5015456-234.7518555 0-37.75494459-36.9345906-68.35043303-82.4922232-68.34111062-45.57627738-0.00932239-82.52019037 30.59548842-82.51086798 68.34111062z" p-id="5406" data-v-c6073ba8></path></svg></div></div></div>
    <script src="/docs/assets/js/app.f6c328c3.js" defer></script><script src="/docs/assets/js/7.2ccd72f8.js" defer></script><script src="/docs/assets/js/2.0ad8144f.js" defer></script><script src="/docs/assets/js/1.487ab7c2.js" defer></script><script src="/docs/assets/js/66.dbe1a90c.js" defer></script>
  </body>
</html>
